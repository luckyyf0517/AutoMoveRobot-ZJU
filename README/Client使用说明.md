# Clientä½¿ç”¨è¯´æ˜

## TOC

1. [è½¯ä»¶å®‰è£…](#è½¯ä»¶å®‰è£…)
2. [è½¯ä»¶åŸºæœ¬ä½¿ç”¨](#è½¯ä»¶åŸºæœ¬ä½¿ç”¨)
3. [æ§åˆ¶æµç¨‹](#æ§åˆ¶æµç¨‹)
4. [Demoç¨‹åºè®²è§£](#Demoç¨‹åºè®²è§£)

## è½¯ä»¶å®‰è£…

### Windowså¹³å°

åœ¨Windowså¹³å°æ‰“å¼€setup.exeï¼Œé€‰æ‹©å®‰è£…ç›®å½•ï¼Œå¦‚`C:\Users\0AQZ0\Desktop\Client`ï¼Œç„¶åä¸€ç›´ç‚¹ä¸‹ä¸€æ­¥å³å¯

**æ³¨æ„ä¸è¦é€‰æ‹©åœ¨éœ€è¦ç®¡ç†å‘˜æƒé™çš„ç›®å½•ï¼Œå¦‚C:\Program Files (x86)\Clientï¼Œå¦åˆ™éœ€è¦ç®¡ç†å‘˜æƒé™æ‰“å¼€**

<img src=".\img\setup.png" alt="setup" style="zoom:38%;" />

### Ubuntuå¹³å°

éœ€è¦ä¸‹è½½QTï¼Œå¹¶ç¼–è¯‘æºç ï¼Œä¸æ¨èä½¿ç”¨

## è½¯ä»¶åŸºæœ¬ä½¿ç”¨

<img src=".\img\fig1.jpg" alt="fig1" style="zoom: 25%;" />

- çº¢è‰²æ–¹æ¡†1çš„æŒ‰é’®å¯ä»¥é€‰æ‹©è¿æ¥æˆ–è€…æ–­å¼€å›¾åƒ

- çº¢è‰²æ–¹æ¡†2çš„æŒ‰é’®é€‰æ‹©æµ‹è¯•çš„åœºæ™¯ï¼Œåˆ†ä¸ºsimpleå’Œhard

  - simpleåœºæ™¯ï¼šåœºä¸Š16ä¸ªæœºå™¨äººï¼Œé™¤äº†éœ€è¦æ§åˆ¶çš„æœºå™¨äººå…¶ä»–ä¸ºé™æ€éšœç¢ç‰©

  - hardåœºæ™¯ï¼šåœºä¸Š16ä¸ªé»„è‰²æœºå™¨äººï¼Œå…¶ä¸­5ä¸ªä¸ºåŠ¨æ€éšœç¢ç‰©ï¼Œå…¶ä»–ä¸ºé™æ€éšœç¢ç‰©

    â€‹					éœ€è¦è¿è¡Œdynamic_obstaclesæ–‡ä»¶å¤¹ä¸­çš„`main.py`ï¼Œå³`python main.py`

- çº¢è‰²æ–¹æ¡†3çš„æŒ‰é’®å¯ä»¥å¿«é€Ÿå…³é—­ç¨‹åº

- çº¢è‰²æ–¹æ¡†4æ˜¾ç¤ºçš„æ˜¯é¼ æ ‡æ‰€æŒ‡ä½ç½®çš„åæ ‡ï¼Œå•ä½mm

- çº¢è‰²æ–¹æ¡†5åˆ†åˆ«æ˜¾ç¤ºå›¾åƒå¸§æ•°ã€è“è½¦æ§åˆ¶æŒ‡ä»¤å¸§æ•°ã€é»„è½¦æ§åˆ¶æŒ‡ä»¤å¸§æ•°

- å¸¸ç”¨å°æŠ€å·§ï¼šè¿æ¥å›¾åƒåï¼Œä½¿ç”¨``ã€1-10ã€-ã€+ã€iã€oã€pã€[`å¯ä»¥æ§åˆ¶è“è½¦æ•°é‡ä»0-16å˜åŒ–ï¼Œå¦‚æœåŒæ—¶æŒ‰ä½`ctrl`å¯ä»¥æ§åˆ¶é»„è½¦æ•°é‡ï¼›é¼ æ ‡å¯ä»¥ç›´æ¥æ‹–åŠ¨æœºå™¨äºº

![fig2](.\img\fig2.jpg)

- ç‚¹å‡»çº¢è‰²æ–¹æ¡†1çš„æŒ‰é’®å¯ä»¥åˆ‡æ¢åˆ°logçš„å·¥å…·æ 
- çº¢è‰²æ–¹æ¡†2çš„æŒ‰é’®å¯ä»¥å¼€å§‹æˆ–è€…åœæ­¢å½•åˆ¶logï¼Œé»˜è®¤å¼€å¯
- çº¢è‰²æ–¹æ¡†3å†…æ˜¾ç¤ºlogæ’­æ”¾ä¿¡æ¯ï¼Œæœ€å·¦è¾¹æ–‡ä»¶å¤¹æŒ‰é’®å¯ä»¥æ‰“å¼€logæ–‡ä»¶è¿›è¡Œæ’­æ”¾ï¼ˆæ‰“å¼€æ—¶éœ€è¦æ–­å¼€å›¾åƒè¿æ¥ï¼‰ï¼Œå…¶ä»–æŒ‰é’®åˆ†åˆ«æ˜¯å¼€å§‹ã€åœæ­¢ã€å¿«é€€ã€å¿«è¿›

## æ§åˆ¶æµç¨‹

![fig3](.\img\fig3.png)

**åŸºæœ¬æµç¨‹**

è‡ªå·±çš„ç¨‹åºæ¥æ”¶æ¥è‡ªClientçš„å›¾åƒä¿¡æ¯ï¼ˆåœºä¸Šæœºå™¨äººçš„ä½ç½®ã€é€Ÿåº¦ç­‰ï¼‰ï¼Œè¿›è¡Œè·¯å¾„ã€é€Ÿåº¦è§„åˆ’ä¹‹åå‘é€å°è½¦æ§åˆ¶æŒ‡ä»¤ç»™Clientã€‚

è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¿¡æ¯çš„ä¼ é€’æ˜¯é€šè¿‡protobufå®ç°çš„ã€‚å½¢è±¡åœ°è¯´ï¼ŒUDPæ˜¯äº¤æµçš„æ–¹å¼ï¼ŒProtobufæ˜¯è¯­è¨€ã€‚

**Protobuf**

protobuf(Protocal Buffers)æ˜¯googleå¼€å‘çš„ä¸€ç§ç”¨äºåºåˆ—åŒ–ç»“æ„åŒ–æ•°æ®ï¼ˆJSONã€XML)çš„ä¸€ç§æ–¹å¼ã€‚å®ƒçµæ´»ã€é«˜æ•ˆï¼Œåªéœ€è¦å…³äºæ•°æ®ç»“æ„çš„æè¿°.protoï¼Œå°±å¯ä»¥ä½¿ç”¨compilerè‡ªåŠ¨ç”Ÿæˆè¿›è¡Œç¼–ç ã€è§£æçš„classï¼Œè¿™ä¸ªclassæä¾›äº†getterå’Œsetterè¿™äº›methodè¯»å†™protobufã€‚[å‚è€ƒé“¾æ¥](https://developers.google.com/protocol-buffers/docs/cpptutorial)

## Demoç¨‹åºè®²è§£

ä¸»è¦æä¾›äº†ä¸¤ä¸ªDemoç¨‹åºï¼Œåˆ†åˆ«å®Œæˆæ¥æ”¶å›¾åƒä¿¡æ¯ã€å‘é€æ§åˆ¶æŒ‡ä»¤ï¼š

- **ssl_demo_python**ï¼šPythonä¾‹ç¨‹ï¼Œéœ€è¦[Python>=3](https://www.python.org/downloads/)ã€ProtobufåŒ…`pip install protobuf`
- **ssl_demo_c++**ï¼šC++ä¾‹ç¨‹ï¼Œéœ€è¦QTã€VS Studioè¿›è¡Œç¼–è¯‘

ä»¥ä¸‹é‡ç‚¹è®²è§£Pythonä¾‹ç¨‹ï¼š

```
ğŸ“¦ssl_demo_python
 â”£ ğŸ“‚proto                                    å®šä¹‰æ•°æ®ç»“æ„çš„æ–‡ä»¶å¤¹
 â”ƒ â”£ ğŸ“œvision_detection.proto				  æ¥æ”¶çš„å›¾åƒçš„æ•°æ®ç»“æ„
 â”ƒ â”£ ğŸ“œzss_cmd.proto						  å‘é€çš„æ§åˆ¶æŒ‡ä»¤çš„æ•°æ®ç»“æ„
 â”ƒ â”— ğŸ“œzss_debug.proto						  å‘é€çš„è°ƒè¯•ä¿¡æ¯çš„æ•°æ®ç»“æ„
 â”£ ğŸ“œaction.py								  å‘é€æ§åˆ¶æŒ‡ä»¤çš„å®ç°ä»£ç 
 â”£ ğŸ“œdebug.py								  å‘é€è°ƒè¯•ä¿¡æ¯çš„å®ç°ä»£ç 
 â”£ ğŸ“œmain.py								  ä¸»ç¨‹åº
 â”£ ğŸ“œvision.py								  æ¥æ”¶å›¾åƒæ•°æ®çš„å®ç°ä»£ç 
 â”£ ğŸ“œvision_detection_pb2.py				  è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œæ— éœ€é˜…è¯»
 â”£ ğŸ“œzss_cmd_pb2.py							  è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œæ— éœ€é˜…è¯»
 â”— ğŸ“œzss_debug_pb2.py						  è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œæ— éœ€é˜…è¯»
```

### æ¥æ”¶å›¾åƒä¿¡æ¯

ç›¸å…³æ–‡ä»¶ï¼š

- vision.py
- vision_detection.proto
- vision_detection_pb2.py

åœ¨`vision.py`é‡Œå®ç°äº†ä¸¤ä¸ªç±»ï¼Œä¸€ä¸ªæ˜¯`Vision`ç”¨äºè¯»å–å›¾åƒæ•°æ®ï¼Œä¸€ä¸ªæ˜¯`Robot`ç”¨äºå­˜å‚¨æ¯ä¸ªæœºå™¨äººçš„æ•°æ®ã€‚

**Robot**å­˜å‚¨äº†æœºå™¨äººçš„IDã€æ˜¯å¦å¯è§ã€ä½ç½®ã€é€Ÿåº¦ã€æœå‘ï¼ˆåˆ†ä¸ºå›¾åƒæ»¤æ³¢åå’Œæ»¤æ³¢å‰ä¸¤ç§ï¼‰

```python
class Robot(object):
	def __init__(self, id, visible=False,
				x=-999999, y=-999999, vel_x=0, vel_y=0, orientation=0,
				raw_x=-999999, raw_y=-999999, raw_vel_x=0, raw_vel_y=0, 				                 raw_orientation=0):
		self.id = id
		self.visible = visible
		# filtered vision
		self.x = x
		self.y = y
		self.vel_x = vel_x
		self.vel_y = vel_y
		self.orientation = orientation
		# raw vision
		self.raw_x = raw_x
		self.raw_y = raw_y
		self.raw_vel_x = raw_vel_x
		self.raw_vel_y = raw_vel_y
		self.raw_orientation = raw_orientation
```

**Vision**é€šè¿‡UDPè¯»å–å›¾åƒæ•°æ®åŒ…ï¼Œå¹¶è§£æå­˜å‚¨åœ¨`blue_robot`å’Œ`yellow_robot`ä¸¤ä¸ªæ•°ç»„ä¸­ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š

```python
from vision import Vision

# å®ä¾‹åŒ–Visionè¿™ä¸ªç±»
vision_module = Vision()

# è¯»å–æˆ‘çš„æœºå™¨äººçš„ä½ç½®ï¼Œé»˜è®¤æˆ‘çš„æœºå™¨äººä¸ºè“è½¦0å·
my_robot = vision_module.my_robot
print('My robot:', my_robot.x, my_robot.y)
# è¯»å–è“è½¦0å·çš„ä½ç½®ï¼Œå…¶ä»–è½¦å·0-15ç±»ä¼¼
blue_robot_0 = vision_module.blue_robot[0]
print('Blue robot 0:', blue_robot_0.x, blue_robot_0.y)
# è¯»å–é»„è½¦0å·çš„ä½ç½®ï¼Œå…¶ä»–è½¦å·0-15ç±»ä¼¼
yellow_robot_0 = vision_module.yellow_robot[0]
print('Yellow robot 0:', yellow_robot_0.x, yellow_robot_0.y)
```

### å‘é€æ§åˆ¶æŒ‡ä»¤

ç›¸å…³æ–‡ä»¶ï¼š

- action.py
- zss_cmd.proto
- zss_cmd_pb2.py

åœ¨`action.py`ä¸­å®ç°äº†`Action`è¿™ä¸ªç±»ï¼Œç”¨äºæ§åˆ¶æˆ‘çš„æœºå™¨äººï¼ˆé»˜è®¤æ˜¯è“è½¦0å·ï¼‰çš„vxå’Œvwï¼Œç”¨æ³•å¦‚ä¸‹ï¼š

**æ³¨æ„æœ¬æ¬¡å®ç°çš„æ˜¯å·®åˆ†é©±åŠ¨ï¼Œä¸è®ºæ˜¯å¦å‘é€vyéƒ½ä¼šè¢«ç›´æ¥ç½®é›¶**

```python
from action import Action

# å®ä¾‹åŒ–Actionè¿™ä¸ªç±»
action_module = Action()
while True:
    # ç»™æˆ‘çš„æœºå™¨äººå‘é€vxä¸º100ï¼Œvwä¸º10çš„é€Ÿåº¦
    action_module.sendCommand(vx=100, vw=10)
    time.sleep(0.02)
```

### ç»˜åˆ¶Debugä¿¡æ¯

ç›¸å…³æ–‡ä»¶ï¼š

- debug.py
- zss_debug.proto
- zss_debug_pb2.py

åœ¨`Debugger`ä¸­å®ç°äº†`Debugger`è¿™ä¸ªç±»ï¼Œç”¨äºç»˜åˆ¶è°ƒè¯•ä¿¡æ¯ï¼Œä¾‹å¦‚ç”»åœ†ã€ç”»çº¿ã€ç”»ç‚¹

- draw_circleâ€”â€”ç”»åœ†ï¼Œå‚æ•°ï¼šåœ†å¿ƒåæ ‡å’ŒåŠå¾„
- draw_lineâ€”â€”ç”»çº¿ï¼Œå‚æ•°ï¼šä¸¤ç‚¹çš„åæ ‡ï¼ˆx1,y1ï¼‰å’Œï¼ˆx2,y2ï¼‰
- draw_linesâ€”â€”ç”»å¤šæ¡çº¿ï¼Œå‚æ•°ï¼šä¸¤ç‚¹çš„åæ ‡åˆ—è¡¨ï¼Œx1,y1,x2,y2éƒ½æ˜¯åˆ—è¡¨
- draw_pointâ€”â€”ç”»ç‚¹ï¼Œå‚æ•°ï¼šç‚¹çš„åæ ‡ï¼ˆx,yï¼‰
- draw_pointsâ€”â€”ç”»å¤šä¸ªç‚¹ï¼Œå‚æ•°ï¼šç‚¹çš„åæ ‡åˆ—è¡¨ï¼Œx,yéƒ½æ˜¯åˆ—è¡¨

**æ³¨æ„æ¯æ¬¡å‘é€æ–°çš„è°ƒè¯•ä¿¡æ¯ï¼Œä¼šå°†ä¸Šæ¬¡å‘é€çš„è¦†ç›–æ‰**

```python
from debug import Debugger
from zss_debug_pb2 import Debug_Msgs

# å®ä¾‹åŒ–Debuggerè¿™ä¸ªç±»
debugger = Debugger()
# å®šä¹‰ä¸€ä¸ªè°ƒè¯•ä¿¡æ¯çš„åŒ…
package = Debug_Msgs()
# ç”»ä¸€ä¸ªåœ†
debugger.draw_circle(package, x=0, y=500)
# ç”»ä¸€æ¡çº¿
debugger.draw_line(package, x1=0, y1=2500, x2=600, y2=2500)
# ç”»å¤šæ¡çº¿
debugger.draw_lines(package, x1=[0,0], y1=[0,2000], x2=[2000,2000], y2=[0,2000])
# ç”»ä¸€ä¸ªç‚¹
debugger.draw_point(package, x=500, y=500)
# ç”»å¤šä¸ªç‚¹
debugger.draw_points(package, x=[1000, 2000], y=[3000, 3000])
# å‘é€è°ƒè¯•ä¿¡æ¯
debugger.send()
```

ç¤ºä¾‹ï¼š

![fig4](.\img\fig4.png)

### ä¸»ç¨‹åº

ç›¸å…³æ–‡ä»¶ï¼š

- main.py

åœ¨`main.py`ä¸­å®ç°äº†ä¸»å‡½æ•°ï¼Œå®Œæˆäº†å›¾åƒæ•°æ®çš„æ¥æ”¶ã€æ§åˆ¶æŒ‡ä»¤å‘é€ã€è°ƒè¯•ä¿¡æ¯ç»˜åˆ¶ã€‚

- **å›¾åƒæ•°æ®æ¥æ”¶**ï¼šé€šè¿‡å®ä¾‹åŒ–`Vision`è¿™ä¸ªç±»å®Œæˆï¼Œä¼šå•ç‹¬å¼€ä¸€ä¸ªçº¿ç¨‹è¯»å–å›¾åƒæ•°æ®ï¼Œåªéœ€è®¿é—®å®ƒçš„æˆå‘˜å˜é‡å³å¯è·å¾—åœºä¸Šæœºå™¨äººçš„ä½ç½®ç­‰ä¿¡æ¯ã€‚
- **è·¯å¾„è§„åˆ’&é€Ÿåº¦è§„åˆ’**ï¼šéœ€è¦åœ¨æ³¨é‡Šå¤„å®Œæˆï¼Œå¯ä»¥å®ç°A*æˆ–è€…RRTã€‚
- **å‘é€æ§åˆ¶æŒ‡ä»¤**ï¼šå®Œæˆè§„åˆ’åå¾—åˆ°è§„åˆ’çš„é€Ÿåº¦vxã€vwï¼Œé€šè¿‡`Action`è¿™ä¸ªç±»å®Œæˆå‘é€ã€‚

```python
from vision import Vision
from action import Action
from debug import Debugger
from zss_debug_pb2 import Debug_Msgs
import time

if __name__ == '__main__':
	vision = Vision()
	action = Action()
	debugger = Debugger()
	while True:
		# 1. path planning & velocity planning
		# Do something

		# 2. send command
		action.sendCommand(vx=100, vy=0, vw=0)

		# 3. draw debug msg
		package = Debug_Msgs()
		debugger.draw_circle(package, vision.my_robot.x, vision.my_robot.y)
		debugger.send(package)

		time.sleep(0.01)
```

